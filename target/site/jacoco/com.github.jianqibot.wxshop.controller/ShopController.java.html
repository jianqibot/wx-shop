<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ShopController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wx-shop</a> &gt; <a href="index.source.html" class="el_package">com.github.jianqibot.wxshop.controller</a> &gt; <span class="el_source">ShopController.java</span></div><h1>ShopController.java</h1><pre class="source lang-java linenums">package com.github.jianqibot.wxshop.controller;

import com.github.jianqibot.wxshop.entity.HttpException;
import com.github.jianqibot.wxshop.entity.PageResponse;
import com.github.jianqibot.wxshop.entity.Response;
import com.github.jianqibot.wxshop.generate.Shop;
import com.github.jianqibot.wxshop.service.ShopService;
import com.github.jianqibot.wxshop.service.UserContext;
import org.springframework.web.bind.annotation.*;

import javax.inject.Inject;
import javax.servlet.http.HttpServletResponse;

@RestController
@RequestMapping(&quot;/api/v1&quot;)
public class ShopController {
    private final ShopService shopService;
    @Inject
<span class="fc" id="L19">    public ShopController(ShopService shopService) {</span>
<span class="fc" id="L20">        this.shopService = shopService;</span>
<span class="fc" id="L21">    }</span>
    /**
     * @api {get} /shop get all shops under current user
     * @apiName GetShop
     * @apiGroup shop
     * @apiHeader {String} Accept application/json
     * @apiParam {Number} pageNum pageNum page number, from 1
     * @apiParam {Number} pageSize pageSize page size, how many item in one page
     * @apiSuccess {Number} pageNum pageNum page number, from 1
     * @apiSuccess {Number} pageSize pageSize page size, how many item in one page
     * @apiSuccess {Number} totalPage page in total
     * @apiSuccess {Shop} data shop list
     * @apiSuccessExample Success-Response:
     * HTTP/1.1 200 OK
     * {
     * &quot;pageNum&quot;: 1,
     * &quot;pageSize&quot;: 10,
     * &quot;totalPage&quot;: 5,
     * &quot;data&quot;: [
     * {
     * &quot;id&quot;: 12345,
     * &quot;name&quot;: &quot;my shop&quot;,
     * &quot;description&quot;: &quot;my soap shop&quot;,
     * &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     * &quot;ownerUserId&quot;: 12345,
     * &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     * &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     * },
     * {
     * ...
     * }
     * ]
     * }
     * @apiError 401 Unauthorized If user hasn't login yet
     * @apiErrorExample Error-Response:
     * HTTP/1.1 401 Unauthorized
     * {
     * &quot;message&quot;: &quot;Unauthorized&quot;
     * }
     */

    /**
     * @param pageNum page number
     * @param pageSize page size
     * @return shop list
     */
    @GetMapping(&quot;/shop&quot;)
    @ResponseBody
    public PageResponse&lt;Shop&gt; getShops(@RequestParam(&quot;pageNum&quot;) Integer pageNum,
                                       @RequestParam(&quot;pageSize&quot;) Integer pageSize) {
<span class="nc" id="L71">        return shopService.getShop(pageNum, pageSize, UserContext.getCurrentUser().getId());</span>
    }


    /**
     * @api {get} /shop/:id get shop with specified ID
     * @apiName GetShopById
     * @apiGroup shop
     * @apiHeader {String} Accept application/json
     * @apiSuccessExample Success-Response:
     * HTTP/1.1 200 Created
     * {
     * &quot;data&quot;: {
     * &quot;id&quot;: 12345,
     * &quot;name&quot;: &quot;my shop&quot;,
     * &quot;description&quot;: &quot;my soap shop&quot;,
     * &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     * &quot;ownerUserId&quot;: 12345,
     * &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     * &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     * }
     * }
     * @apiError 401 Unauthorized If user hasn't login yet
     * @apiError 404 Not found If shop not found
     * @apiErrorExample Error-Response:
     * HTTP/1.1 401 Unauthorized
     * {
     * &quot;message&quot;: &quot;Unauthorized&quot;
     * }
     */
    /**
     * @param shopId shop ID
     * @param response http response
     * @return response of Shop type
     */
    @GetMapping(&quot;/shop/{id}&quot;)
    @ResponseBody
    public Response&lt;Shop&gt; getShop(@PathVariable(&quot;id&quot;) Long shopId,
                                  HttpServletResponse response) {
        try {
<span class="nc" id="L111">            return Response.of(shopService.getShopById(shopId));</span>
<span class="nc" id="L112">        } catch (HttpException e) {</span>
<span class="nc" id="L113">            response.setStatus(e.getStatusCode());</span>
<span class="nc" id="L114">            return Response.error(e.getMessage());</span>
        }
    }


    /**
     * @api {post} /shop create shop
     * @apiName CreateShop
     * @apiGroup shop
     * @apiHeader {String} Accept application/json
     * @apiHeader {String} Content-Type application/json
     * @apiParamExample {json} Request-Example:
     * {
     * &quot;id&quot;: 12345,
     * &quot;name&quot;: &quot;my shop&quot;,
     * &quot;description&quot;: &quot;my soap shop&quot;,
     * &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     * }
     * @apiSuccessExample Success-Response:
     * HTTP/1.1 201 Created
     * {
     * &quot;data&quot;: {
     * &quot;id&quot;: 12345,
     * &quot;name&quot;: &quot;my shop&quot;,
     * &quot;description&quot;: &quot;my soap shop&quot;,
     * &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     * &quot;ownerUserId&quot;: 12345,
     * &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     * &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     * }
     * }
     * @apiError 400 Bad Request If request contains error
     * @apiError 401 Unauthorized If user hasn't login yet
     * @apiErrorExample Error-Response:
     * HTTP/1.1 401 Unauthorized
     * {
     * &quot;message&quot;: &quot;Unauthorized&quot;
     * }
     */
    /**
     * @param shop shop to be created
     * @param response http response
     * @return response of Shop type
     */
    @PostMapping(&quot;/shop&quot;)
    @ResponseBody
    public Response&lt;Shop&gt; createShop(@RequestBody Shop shop,
                                     HttpServletResponse response) {
        try {
<span class="fc" id="L163">            return Response.of(shopService.createShop(shop, UserContext.getCurrentUser().getId()));</span>
<span class="nc" id="L164">        } catch (HttpException e) {</span>
<span class="nc" id="L165">            response.setStatus(e.getStatusCode());</span>
<span class="nc" id="L166">            return Response.error(e.getMessage());</span>
        }
    }


    /**
     * @api {PATCH} /shop/:id modify shop
     * @apiName UpdateShop
     * @apiGroup shop
     * @apiParam {Number} id shop ID
     * @apiHeader {String} Accept application/json
     * @apiHeader {String} Content-Type application/json
     * @apiParamExample {json} Request-Example:
     * {
     * &quot;id&quot;: 12345,
     * &quot;name&quot;: &quot;my shop&quot;,
     * &quot;description&quot;: &quot;my soap shop&quot;,
     * &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     * }
     * @apiSuccessExample Success-Response:
     * HTTP/1.1 200 OK
     * {
     * &quot;data&quot;: {
     * &quot;id&quot;: 12345,
     * &quot;name&quot;: &quot;my shop&quot;,
     * &quot;description&quot;: &quot;my soap shop&quot;,
     * &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     * &quot;ownerUserId&quot;: 12345,
     * &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     * &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     * }
     * }
     * @apiError 400 Bad Request If request contains error
     * @apiError 401 Unauthorized If user hasn't login yet
     * @apiError 403 Forbidden If user tries to modify shop does not belong to him
     * @apiError 404 Not Found shop not found
     * @apiErrorExample Error-Response:
     * HTTP/1.1 401 Unauthorized
     * {
     * &quot;message&quot;: &quot;Unauthorized&quot;
     * }
     */
    /**
     * @param shopId shop ID
     * @param shopForUpdate shop to be updated
     * @param response http reponse
     * @return response of Shop type
     */
    @PatchMapping(&quot;/shop/{id}&quot;)
    @ResponseBody
    public Response&lt;Shop&gt; modifyShop(@PathVariable(&quot;id&quot;) Long shopId,
                                     @RequestBody Shop shopForUpdate,
                                     HttpServletResponse response) {
        try {
<span class="nc" id="L220">            return Response.of(shopService.modifyShop(shopId, shopForUpdate, UserContext.getCurrentUser().getId()));</span>
<span class="nc" id="L221">        } catch (HttpException e) {</span>
<span class="nc" id="L222">            response.setStatus(e.getStatusCode());</span>
<span class="nc" id="L223">            return Response.error(e.getMessage());</span>
        }
    }


    /**
     * @api {DELETE} /shop/:id delete shop
     * @apiName DeleteShop
     * @apiGroup shop
     *
     * @apiHeader {String} Accept application/json
     *
     * @apiParam {Number} id shop ID
     *
     * @apiSuccessExample Success-Response:
     *     HTTP/1.1 204 No Content
     *     {
     *       &quot;data&quot;: {
     *              &quot;id&quot;: 12345,
     *              &quot;name&quot;: &quot;my shop&quot;,
     *              &quot;description&quot;: &quot;my soap shop&quot;,
     *              &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     *              &quot;ownerUserId&quot;: 12345,
     *              &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     *              &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     *       }
     *     }
     *
     * @apiError 400 Bad Request If request contains error
     * @apiError 401 Unauthorized If user hasn't login yet
     * @apiError 403 Forbidden If user tries to delete shop does not belong to him
     * @apiError 404 Not Found shop not found
     *
     * @apiErrorExample Error-Response:
     *     HTTP/1.1 401 Unauthorized
     *     {
     *       &quot;message&quot;: &quot;Unauthorized&quot;
     *     }
     */
    /**
     * @param shopId shop ID
     * @param response http response
     * @return response of Shop type
     */
    @DeleteMapping(&quot;/shop/{id}&quot;)
    @ResponseBody
    public Response&lt;Shop&gt; deleteShop(@PathVariable(&quot;id&quot;) Long shopId,
                                     HttpServletResponse response) {
        try {
<span class="nc" id="L272">            return Response.of(shopService.deleteShop(shopId, UserContext.getCurrentUser().getId()));</span>
<span class="nc" id="L273">        } catch (HttpException e) {</span>
<span class="nc" id="L274">            response.setStatus(e.getStatusCode());</span>
<span class="nc" id="L275">            return Response.error(e.getMessage());</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>