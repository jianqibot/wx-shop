<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ShoppingCartController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wx-shop</a> &gt; <a href="index.source.html" class="el_package">com.github.jianqibot.wxshop.controller</a> &gt; <span class="el_source">ShoppingCartController.java</span></div><h1>ShoppingCartController.java</h1><pre class="source lang-java linenums">package com.github.jianqibot.wxshop.controller;

import com.github.jianqibot.wxshop.entity.*;
import com.github.jianqibot.wxshop.service.ShoppingCartService;
import com.github.jianqibot.wxshop.service.UserContext;
import org.springframework.web.bind.annotation.*;

import javax.inject.Inject;
import javax.servlet.http.HttpServletResponse;

@RestController
@RequestMapping(&quot;/api/v1&quot;)
public class ShoppingCartController {

    private final ShoppingCartService shoppingCartService;

    @Inject
<span class="fc" id="L18">    public ShoppingCartController(ShoppingCartService shoppingCartService) {</span>
<span class="fc" id="L19">        this.shoppingCartService = shoppingCartService;</span>
<span class="fc" id="L20">    }</span>

    /**
     * @api {get} /shoppingCart fetch list of goods in the shopping cart under current user
     * @apiName GetShoppingCart
     * @apiGroup shopping cart
     *
     * @apiHeader {String} Accept application/json
     *
     * @apiParam {Number} pageNum page number(starting from 1)
     * @apiParam {Number} pageSize page size
     *
     * @apiSuccess {Number} pageNum page number(starting from 1)
     * @apiSuccess {Number} pageSize page size
     * @apiSuccess {Number} totalPage page number in total
     * @apiSuccess {ShoppingCart} data goods in shopping cart, grouped by shop id
     *
     * @apiSuccessExample Success-Response:
     *     HTTP/1.1 200 OK
     *     {
     *       &quot;pageNum&quot;: 1,
     *       &quot;pageSize&quot;: 10,
     *       &quot;totalPage&quot;: 5,
     *       &quot;data&quot;: [
     *         {
     *           &quot;shop&quot;: {
     *              &quot;id&quot;: 12345,
     *              &quot;name&quot;: &quot;my shop&quot;,
     *              &quot;description&quot;: &quot;my apple shop&quot;,
     *              &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     *              &quot;ownerUserId&quot;: 12345,
     *              &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     *              &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     *            },
     *            &quot;goods&quot;: [
     *              {
     *                  &quot;id&quot;: 12345,
     *                  &quot;name&quot;: &quot;soap&quot;,
     *                  &quot;description&quot;: &quot;coconut soap&quot;,
     *                  &quot;details&quot;: &quot;coconut soap made with premium material&quot;,
     *                  &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     *                  &quot;price&quot;: 500,
     *                  &quot;number&quot;: 10,
     *                  &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     *                  &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     *              },
     *              {
     *                    ...
     *              }
     *           ]
     *         }
     *       ]
     *     }
     *
     * @apiError 401 Unauthorized if user hasn't login yet
     *
     * @apiErrorExample Error-Response:
     *     HTTP/1.1 401 Unauthorized
     *     {
     *       &quot;message&quot;: &quot;Unauthorized&quot;
     *     }
     */
    /**
     * @param pageNum  page number
     * @param pageSize page size
     * @return page response of ShoppingCartResponse type
     */

    @GetMapping(&quot;/shoppingCart&quot;)
    @ResponseBody
    public PageResponse&lt;ShoppingCartResponse&gt; shopCart(@RequestParam(&quot;pageNum&quot;) Integer pageNum,
                                                       @RequestParam(&quot;pageSize&quot;) Integer pageSize) {
<span class="fc" id="L92">        return shoppingCartService.getShopCart(pageNum, pageSize, UserContext.getCurrentUser().getId());</span>
    }


    /**
     * @api {post} /shoppingCart add shopping cart
     * @apiName AddShoppingCart
     * @apiGroup shopping cart
     * @apiHeader {String} Accept application/json
     * @apiHeader {String} Content-Type application/json
     * @apiParamExample {json} Request-Example:
     * {
     * &quot;goods&quot;: [
     * {
     * &quot;id&quot;: 12345,
     * &quot;number&quot;: 10,
     * },
     * {
     * ...
     * }
     * }
     * @apiSuccess {ShoppingCart} data goods list of that shop after update
     * @apiSuccessExample Success-Response:
     * HTTP/1.1 200 OK
     * {
     * &quot;data&quot;: {
     * &quot;shop&quot;: {
     * &quot;id&quot;: 12345,
     * &quot;name&quot;: &quot;my shop&quot;,
     * &quot;description&quot;: &quot;my soap shop&quot;,
     * &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     * &quot;ownerUserId&quot;: 12345,
     * &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     * &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     * },
     * &quot;goods&quot;: [
     * {
     * &quot;id&quot;: 12345,
     * &quot;name&quot;: &quot;soap&quot;,
     * &quot;description&quot;: &quot;coconut soap&quot;,
     * &quot;details&quot;: &quot;coconut soap made with premium material&quot;,
     * &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     * &quot;address&quot;: &quot;XXX&quot;,
     * &quot;price&quot;: 500,
     * &quot;number&quot;: 10,
     * &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     * &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     * },
     * {
     * ...
     * }
     * ]
     * }
     * }
     * }
     * @apiError 400 Bad Request if request contains error
     * @apiError 401 Unauthorized if user has not login yet
     * @apiError 404 Not Found if goods cannot be found
     * @apiErrorExample Error-Response:
     * HTTP/1.1 401 Unauthorized
     * {
     * &quot;message&quot;: &quot;Unauthorized&quot;
     * }
     */
    /**
     *
     * @param GoodsToBeAdded new goods to be added
     * @param response HttpServletResponse
     * @return response of ShoppingCartResponse type
     */

    @PostMapping(&quot;/shoppingCart&quot;)
    @ResponseBody
    public Response&lt;ShoppingCartResponse&gt; addToShoppingCart(@RequestBody GoodsInShoppingCart GoodsToBeAdded,
                                                   HttpServletResponse response) {
        try {
<span class="fc" id="L168">            return shoppingCartService.updateShoppingCart(GoodsToBeAdded, UserContext.getCurrentUser().getId());</span>
<span class="nc" id="L169">        } catch (HttpException e) {</span>
<span class="nc" id="L170">            response.setStatus(e.getStatusCode());</span>
        }
<span class="nc" id="L172">        return Response.of(null);</span>
    }


    /**
     * @api {delete} /shoppingCart/:goodsId 删除当前用户购物车中指定的商品
     * @apiName DeleteShoppingCart
     * @apiGroup shopping cart
     *
     * @apiHeader {String} Accept application/json
     *
     * @apiParam {Number} goodsId ID of the goods to be deleted
     *
     * @apiSuccess {ShoppingCart} data goods list of that shop after deletion
     *
     * @apiSuccessExample Success-Response:
     *     HTTP/1.1 200 OK
     *     {
     *       &quot;data&quot;: {
     *           &quot;shop&quot;: {
     *              &quot;id&quot;: 12345,
     *              &quot;name&quot;: &quot;my shop&quot;,
     *              &quot;description&quot;: &quot;my soap shop&quot;,
     *              &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     *              &quot;ownerUserId&quot;: 12345,
     *              &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     *              &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     *            },
     *            &quot;goods&quot;: [
     *              {
     *                  &quot;id&quot;: 12345,
     *                  &quot;name&quot;: &quot;soap&quot;,
     *                  &quot;description&quot;: &quot;coconut soap&quot;,
     *                  &quot;details&quot;: &quot;coconut soap made with premium material&quot;,
     *                  &quot;imgUrl&quot;: &quot;https://img.url&quot;,
     *                  &quot;address&quot;: &quot;XXX&quot;,
     *                  &quot;price&quot;: 500,
     *                  &quot;number&quot;: 10,
     *                  &quot;createdAt&quot;: &quot;2020-03-22T13:22:03Z&quot;,
     *                  &quot;updatedAt&quot;: &quot;2020-03-22T13:22:03Z&quot;
     *              },
     *              {
     *                    ...
     *              }
     *           ]
     *         }
     *       }
     *     }
     *
     * @apiError 401 Unauthorized 若用户未登录
     *
     * @apiErrorExample Error-Response:
     *     HTTP/1.1 401 Unauthorized
     *     {
     *       &quot;message&quot;: &quot;Unauthorized&quot;
     *     }
     */
    /**
     *
     * @param goodsId Id of goods to be deleted
     * @return response of ShoppingCartResponse type
     */

    @DeleteMapping(&quot;/shoppingCart/{goodsId}&quot;)
    @ResponseBody
    public Response&lt;ShoppingCartResponse&gt; deleteShoppingCart(@PathVariable(&quot;goodsId&quot;) Long goodsId) {
<span class="fc" id="L238">        return shoppingCartService.deleteGoodsInShoppingCart(goodsId, UserContext.getCurrentUser().getId());</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>